# 2023_DSA_iOS

## Руководство по эксплуатации системы
### Общая информация
![image](https://user-images.githubusercontent.com/60274420/227986991-10abf151-e219-400f-8a83-8750fcd720bb.png)

Система состоит из серверной части (сервер, база данных и рекомендательная модель), веб-интерфейса и мобильного приложения. С точки зрения кода, существуют файлы серверной части и веб-интерфейса вместе и файлы мобильного приложения, которые запускаются на разных устройствах.

### Руководство по поддержке мобильного приложения
Мобильное приложение написано c использованием языка [Swift](https://www.apple.com/ru/swift/) (версии 5) и среды разработки [XCode](https://developer.apple.com/xcode/) (14.2). Для изменения кода приложения вам потребуется ноутбук Macbook, данные инструменты, а также инструменты [UIKit](https://getuikit.com/) и [SwiftUI](https://developer.apple.com/xcode/swiftui/) для написания пользовательского интерфейса, [Foundation](https://developer.apple.com/documentation/foundation) для работы с основными сущностями языка Swift, [Combine](https://developer.apple.com/documentation/combine) для реактивного программирования, [SwiftPM](https://www.swift.org/package-manager/) и библиотека [Alamofire](https://github.com/Alamofire/Alamofire)  для работы с сетью (подключается с помощью SwiftPM). Убедитесь, что у вас установлены все эти инструменты, прежде чем начать работу над приложением.
Исходный код приложения доступен в ветке mobileAppMVP данного репозитория.
#### Структура мобильного приложения
Приложение организовано в парадигме [ModelViewViewModel+Coordinator](https://medium.com/nerd-for-tech/mvvm-coordinators-ios-architecture-tutorial-fb27eaa36470). 
В основной директории находятся две главные директории: Scenes, отвечающие за реализацию архитектурного паттерна, в сцене каждого экрана находятся следующие разделы: Model(Модели данных), View(Дополнительно реализованные View), ViewModel(ViewModel для работы с сервисами и обновления данных на UI), ViewController(То что в архитектуре является View, основная сущность экрана) и Services, в котором находятся сервис для работы с сетью и вспомогательные модели данных. 

Для изменения взаимодействия с сервером (например, добавления нового запроса) обратитесь к файлу MobieApp/CWChooser/Services/NetworkService.swift.

Для изменения поведения или внешнего вида найдите директорию внутри директории Scenes, соответствующую вашему целевому экрану:
* AuthorizationScene - экран авторизации пользователя.
* CreateProjectScene - экран создания проекта.
* MainScene - экран списка проектов.
* ProfileScene - экран личного кабинета пользователя.
* ProjectDetailScene - экран отображения подробной информации о проекте.
* QuizScene - экран опроса интересов пользователя.

### Руководство по поддержке сервера
Для разработки сервера был использован [Django rest framework](https://www.django-rest-framework.org/) с использованием библиотеки [django allauth]( https://django-allauth.readthedocs.io/en/latest/) для осуществления аутентификации. Разработка осуществлялась на языке [Python](https://www.python.org/) и html.
Базы данных написаны на языке SQL на базе [PostgreSQL](https://www.postgresql.org/). Для разработки использовалась среда [DataGrip](https://www.jetbrains.com/ru-ru/datagrip/). Убедитесь, что у вас установлены все необходимые инструменты, в частности пакеты Python и Django rest framework.
Исходный код сервера можно найти в ветке main данного репозитория.
#### Структура сервера
В ветке main данного репозитория находится директория env с виртуальной средой, нужной для работы Python с проектом, и директория nate_kp, соответствующая всему проекту Django rest framework.
##### Директория nate_kp - старшая
Внутри этой директории nate_kp располагаются объекты проекта: 
* директория nate_kp с файлами, относящимися ко всему проекту целиком, в частности с настройками, 
* директория provider, где расположено приложение для расширения библиотечного решения авторизации django allauth [28], позволяющее подключить провайдера авторизации кроме заданных (например, ЕЛК ВШЭ),
* директория server - относящаяся к приложению, собственно, сервера, используемого в этом проекте и взаимодействующего с базой данных, 
* директория templates, содержащая документы верстки html страниц, 
* файл manage.py, с помощью которого запускаются приложения проекта.

###### Директория nate_kp - младшая
todo

###### Директория provider
Это директория для кастомного провайдера аутентификации пользователя, расширяющего сущность провайдера из библиотеки django-allauth. В целом не нуждается в редактировании и готов к использованию, но можно изменить в соответствии с потребностями от провайдера. Например, можно определить, какие поля будут захватываться при аутентификации из данных стороннего сервиса в файле provider.py. 

###### Директория server
В директории server находятся наиболее интересующие для разработки файлы:
* model.py - это файл рекомендательной системы. Она импортируется в файл views.py и вызывается оттуда в классе student_suggestionsDetail, который отвечает за предоставление информации о рекомендованных студенту проектах. Внутри файл model.py должен содержать функцию run, внутри которой должна происходить вся работа - именно эта функция и запускается снаружи. Если захотите изменить или заменить файл, соблюдайте его расположение и эту структуру.
* models.py - это модели данных. Здесь описываются сущности системы, и они должны соответствовать схемам таблиц в базе данных.
* permissions.py - файл, в котором описаны ограничения доступа к информации для пользователей, далее указываемые в представлениях данных. Можно добавить свои настройки ограничений с помощью классов в этом файле.
* serializers.py - это файл классов-сериализаторов для определения json представлений всех объектов из моделей.
* urls.py - это файл с endpoint ссылками - адресами, доступными для пользователей веб-интерфейса и запросами, доступными для совершения с клиентских частей.
* views.py - это представления данных, на которые пользователей переводят ссылки. Например, если по ссылке пользователь должен увидеть список объектов - класс, соответствующий этому списку нужно задать в этом файле и указать при создании ссылки в файле urls.py.

###### Директория templates
Здесь находится файл home.html - разметка домашней страницы. Чтобы поменять внешний вид страницы по домашнему адресу поменяйте код внутри этого файла.

#### Основные команды и действия
Наиболее нужные из команд в связи со сценариями перечислены ниже. Они написаны для терминала системы Linux. Вместо python3 используйте версию python, установленную на вашем устройстве.
##### Запустить сервер
из директории верхнего уровня (в которой расположена директория env) введите команду: 
$ source env/bin/activate
спуститесь в директорию nate_kp (где расположен файл manage.py) и введите команду:
$ python3 manage.py runserver 0.0.0.0:8000
Эта команда соответствует запуску сервера на порте 8000.
##### Синхронизировать измененную модель данных с базой данных Postgres
из директории nate_kp (где расположен файл manage.py) введите команду:
$ python3 manage.py makemigrations
эта команда покажет вам существующие изменения. Если есть изменения и вы хотите их применить, введите команду:
$ python3 manage.py migrate
##### Добавить новую сущность в базу данных с помощью серверного представления
Сущности располагаются в файле models.py. Добавьте туда требуемый класс, укажите его поля, метаинформацию (название таблицы. Она не обязательно должна существовать, если ее нет - она сгенерируется автоматически). 
Далее определите сериализатор нового типа объектов в файле serializers.py. Здесь определяется json формат, в который будет преобразовываться объект. Вы можете добавить туда не все поля модели и, например, скрыть какую-то информацию. Обязательно в сериализаторе укажите используемую модель данных, которую вы создали ранее (и не забудьте экспортировать ее в файл сериализаторов с помощью импорта наверху).
Далее определите представления нового типа с помощью создания класса в файле views.py по аналогии с существующими - какие действия пользователь может делать с этим объектом? Джанго предоставляет ряд стандартных представлений, например: generics.ListAPIView - это список объектов данного типа, предоставляет список, generics.CreateAPIView - это создание одного нового объекта такого типа, имеет только метод POST, generics.RetrieveUpdateDestroyAPIView - доступ к существующему объекту для просмотра (GET), удаления (DELETE), редактирования (PUT), предоставляет единичный элемент, и т.д. Укажите используемый сериализатор, созданный ранее (и не забудьте его импортировать в текущий файл) и возможные фильтры для запросов. 
Теперь добавьте в файл urls.py ссылки для доступа к новому представлению (не забудьте его импортировать). Для этого добавьте ссылку в список ссылок по аналогии с другими и укажите требуемое представление.
Наконец, введите команды для синхронизации измененной модели с базой данных и запустите сервер - изменения отразятся там.

Например, для сущности проекта

Модель в models.py выглядит так:
class project(models.Model):
    title = models.CharField("title", max_length=255)
    description = models.CharField("description", max_length=5000)
    project_type = models.CharField("project_type", max_length=20)
    supervisor = models.CharField("supervisor", max_length=100, default = "")
    number_of_students = models.IntegerField("number_of_students")
    submission_deadline = models.CharField("submission_deadline", max_length = 20)
    application_deadline = models.CharField("application_deadline", max_length = 20)
    application_form = models.CharField("application_form", max_length=255)
    status = models.CharField("status", max_length=20)
    
    class Meta:
        managed = False
        db_table='project'
        
Сериализатор в serializers.py выглядит так:
class projectSerializer(serializers.ModelSerializer):

    class Meta:
        model = project
        fields = ['id', 'title', 'description', 'project_type', 'supervisor', 'number_of_students', 'submission_deadline', 'application_deadline', 'application_form', 'status']
        
 Представления во views.py выглядят так:
 Для создания проекта
 class projectCreate(generics.CreateAPIView):
    # API endpoint that allows creation of a new customer
    queryset = project.objects.all(),
    serializer_class = projectSerializer

Для списка проектов
class projectList(generics.ListAPIView):
    # API endpoint that allows customer to be viewed.
    queryset = project.objects.all()
    serializer_class = projectSerializer

Для просмотра, редактирования и удаления конкретного проекта
class projectDetail(generics.RetrieveUpdateDestroyAPIView):
    # API endpoint that returns a single customer by pk.
    queryset = project.objects.all()
    serializer_class = projectSerializer
    
Ссылки в urls.py выглядят так:

Для создания нового проекта
path('project_create/', projectCreate.as_view()),
 
Для просмотра списка проектов
path('projects/', projectList.as_view()),

Для просмотра, редактирования, удаления конкретного проекта по ключу его идентификатора
path('projects/<int:pk>/', projectDetail.as_view()),

#### Структура базы данных
todo


### [Руководство по эксплуатации конечными пользователями]([https://github.com/aparinov/2023_DSA_iOS/blob/main/%D0%A0%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE%20%D0%BF%D0%BE%20%D1%8D%D0%BA%D1%81%D0%BF%D0%BB%D1%83%D0%B0%D1%82%D0%B0%D1%86%D0%B8%D0%B8%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0.md](https://github.com/aparinov/2023_DSA_iOS/blob/main/%D0%A0%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE%20%D0%BF%D0%BE%20%D1%8D%D0%BA%D1%81%D0%BF%D0%BB%D1%83%D0%B0%D1%82%D0%B0%D1%86%D0%B8%D0%B8%20%D0%BA%D0%BE%D0%BD%D0%B5%D1%87%D0%BD%D1%8B%D0%BC%D0%B8%20%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D0%BC%D0%B8.md))
___________________________________________________________________________________________________________
Над системой работали:
[Зубарева Наталия](https://github.com/HowToCodeWithPaws)
[Мостачев Андрей](https://github.com/AndrewMOST)
[Поволоцкий Виктор](https://github.com/Tramatusin)
[Сальникова Алиса](https://github.com/Teytid)
2023
